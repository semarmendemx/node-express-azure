trigger:
- master

pool:
  vmImage: 'Ubuntu-16.04'

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '8.x'
  displayName: 'Install Node.js'

- script: |
    npm install
  displayName: 'npm install'

- script: |
    npm test
  displayName: 'npm test'

- task: ArchiveFiles@2
  displayName: 'Archive files'
  inputs:
    rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
    includeRootFolder: false
- task: Veracode@3
  inputs:
    ConnectionDetailsSelection: 'Credentials'
    apiId: '8e2d2d096212bd9cc3d241a7085fcd27'
    apiKey: '4c1158a04b9340a39b464e98cb46fdd14d5c72f2870cc5da2cf71eef0336ec69f9eee9734359f4af1354720978f3d6de4c0e4557eb0758c81ba7b5804367d886'
    veracodeAppProfile: 'AIA SG - COAST'
    version: '$(build.buildNumber)'
    filepath: '$(build.artifactstagingdirectory)'
    createSandBox: true
    createProfile: false
    failTheBuildIfVeracodeScanDidNotInitiate: false
    scanStatusCheckInterval: '30'
    importResults: true
    failBuildOnPolicyFail: false

- task: PublishBuildArtifacts@1
  displayName: 'Publish artifacts: drop'
  
